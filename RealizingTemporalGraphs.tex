\documentclass[11pt,a4paper]{article}

\usepackage[english]{babel}

\usepackage{fullpage}

\usepackage{amsmath}
\let\proof\relax
\let\endproof\relax


\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{mathrsfs}
\usepackage{wrapfig} %wrap the text around the picture

\usepackage{thmtools} 
\usepackage{thm-restate}

\usepackage{caption} %for subfigure - join multiple figures and add captions
\usepackage{subcaption}
\usepackage{changepage} %inside figure we can put \begin{adjustwidth}{-1cm}{-1cm} \end{adjustwidth} and we can ignore the margins
\usepackage{mathtools} % write text [under]{over} arrow $\xrightarrow[\text{world}]{\text{hello}}$

\usepackage{graphicx}
\graphicspath{{Figures/}}

%\usepackage{enumitem} %enumerate 
\usepackage{enumerate}
\usepackage{todonotes}
\newcommand{\todonkl}[2][]{\todo[color=red!100!green!33,#1]{NKL:\\ #2}} %todo note that starts with NKL:
\setlength{\marginparwidth}{3.7cm} %setting the length of todonote

\newtheorem{theorem}{Theorem}
\newtheorem{observation}{Observation}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{conjecture}[theorem]{Conjecture}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[definition]{Example}
\usepackage{comment}

\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

%font encoding
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}

\usepackage{hyperref}

\usepackage[capitalise,nameinlink, noabbrev]{cleveref}
\crefname{claim}{Claim}{Claims}
\crefname{observation}{Observation}{Observations}

\usepackage{authblk}

%\usepackage{natbib}

\newcommand{\ie}{i.\,e.,\ }
\newcommand{\st}{s.\,t.,\ }
\newcommand{\NP}{\textrm{NP}}
\newcommand{\APX}{\textrm{APX}}
\newcommand{\FPT}{\textrm{FPT}}
\newcommand{\XP}{\textrm{XP}}

\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\QQ}{\mathbb{Q}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Defining a problem
%%%%%%%%%%%%%%%%%%\problemdef{NAME} {Input} {Output}
\usepackage{tabularx}
\newcommand{\problemdef}[3]{
	\begin{center}
		\begin{minipage}{0.95\textwidth}
			\noindent
			#1
			\vspace{5pt}\\
			\setlength{\tabcolsep}{3pt}
			\begin{tabularx}{\textwidth}{@{}lX@{}}
				\textbf{Input:}& #2 \\
				\textbf{Question:}& #3
			\end{tabularx}
		\end{minipage}
	\end{center}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% PROBLEMS NAMES
%% One label per edge, period Delta, exact realization
\newcommand{\deltaExactLong}{\textsc{Simple $\Delta$-periodic Exact Temporal Graph Realization}}
\newcommand{\deltaExact}{\textsc{Simple $\Delta$-TGR}}

%% k labels per edge, period Delta, exact realization
\newcommand{\kDeltaExactLong}{\textsc{$(k,\Delta)$-periodic Exact Temporal Graph Realization}}
\newcommand{\kDeltaExact}{\textsc{$(k,\Delta)$-TGR}}

%% One label per edge, period Delta, upper-bounded realization
\newcommand{\kDeltaUpperBoundLong}{\textsc{Simple $\Delta$-periodic Upper-Bounded Temporal Graph Realization}}
%\newcommand{\deltaUpperBound}{}

%% k labels per edge, period Delta, lower-bound realization
\newcommand{\kDeltaLowerBoundLong}{\textsc{Simple $\Delta$-periodic Lower-Bounded Temporal Graph Realization}}


\title{Realizing Temporal Graphs}
\author{Nina Klobas, George B. Mertzios, Hendrik Molter, Paul G. Spirakis}


\bibliographystyle{abbrv}
\begin{document}
	\maketitle

\section{Ideas}
\begin{itemize}
    \item Symmetric distance matrix $D$: polytime?
    \item Use $|D|_\infty$ (maximum value in $D$) + max degree $\Delta$ as parameter $\rightarrow$ should give FPT
    \item FPT with feedback edge number
    \item use as parameter $\max_{i,j} |D_{i,j}-D_{j,i}|$
    \item approximation (additive or multiplicative), maybe with graph as input
\end{itemize}

\section{Preliminaries}

Let $G=(V,E)$ and $k,\Delta\in \mathbb{N}$, and let $\lambda: E \rightarrow \{1,2,\ldots,\Delta\}^k$ be an edge-labeling function that assigns to every edge of $G$ exactly $k$ different labels from $\{1,\ldots,\Delta\}$. 
Then we denote by $(G,\lambda,\Delta)$ the \emph{$\Delta$-periodic temporal graph} $(G,\lambda_{\Delta})$, where for every edge $e\in E$ we have $\lambda_{\Delta}(e)=\{i\Delta + x : i\geq 0, x\in \lambda(e)\}$. 
In this case we call $\lambda$ a \emph{$\Delta$-periodic labeling} of $G$. If $k=1$, we call $\lambda$ a \emph{simple $\Delta$-periodic labeling} of $G$.

\begin{definition}[temporal path]
Let $(G,\lambda)$ be a temporal graph. A \emph{temporal path} $P$ from $u=u_0$ to $v=u_k$ in $(G,\lambda)$ is a sequence $(u_0 u_1,t_1),(u_1 u_2,t_2),\ldots,(u_{k-1} u_k,t_k)$, where $(u_0,u_1,\ldots,u_k)$ is a path in the underlying static graph $G$, $t_i\in \lambda(u_{i-1}u_i)$ for every $i=1,\ldots,k$, and $t_1<t_2<\ldots<t_k$. 
The \emph{duration} of this temporal path $P$ from $u$ to $v$ is $d(P)=t_k - t_1 + 1$.
A \emph{fastest} temporal path $P$ from $u$ to $v$ in $(G,\lambda)$ is a temporal path from $u$ to $v$ with the smallest possible duration.
The duration of the \emph{fastest} temporal path from $u$ to $v$ is denoted by $d(u,v)$.
\end{definition}

	
	
\problemdef{\deltaExactLong\ (\deltaExact)}
{An $n \times n$ matrix $D$.}
{Does there exist a graph $G=(V,E)$ with vertices $\{v_1,\ldots,v_{n}\}$ 
and a simple $\Delta$-periodic labeling $\lambda: E \rightarrow \{1,2,\ldots,\Delta\}$ such that, 
for every $i,j$, the duration of the fastest temporal path from $v_i$ to $v_j$ in the $\Delta$-periodic temporal graph $(G,\lambda,\Delta)$ is equal to $D_{i,j}$.}

\problemdef{\kDeltaExactLong\ (\kDeltaExact)}
{An $n \times n$ matrix $D$ of positive integers.}
{Does there exist a graph $G=(V,E)$ with vertices $\{v_1,\ldots,v_{n}\}$ 
and a $\Delta$-periodic labeling $\lambda: E \rightarrow \{1,2,\ldots,\Delta\}^k$ such that, 
for every $i,j$, the duration of the fastest temporal path from $v_i$ to $v_j$ in the $\Delta$-periodic temporal graph $(G,\lambda,\Delta)$ is equal to $D_{i,j}$.}

\problemdef{\kDeltaUpperBoundLong}
{An $n \times n$ matrix $D$ of positive integers and an integer $k\in \mathbb{N}$.}
{Does there exist a graph $G=(V,E)$ with vertices $\{v_1,\ldots,v_{n}\}$ with $n+k-1$ edges 
and a $\Delta$-periodic labeling $\lambda: E \rightarrow \{1,2,\ldots,\Delta\}$ such that, 
for every $i,j$, the duration of the fastest temporal path from $v_i$ to $v_j$ in the $\Delta$-periodic temporal graph $(G,\lambda,\Delta)$ is \emph{at most} $D_{i,j}$.}

\problemdef{\kDeltaLowerBoundLong}
{An $n \times n$ matrix $D$ of positive integers and an integer $k\in \mathbb{N}$.}
{Does there exist a graph $G=(V,E)$ on the vertices $\{v_1,\ldots,v_{n}\}$ with $n+k-1$ edges 
and a $\Delta$-periodic labeling $\lambda: E \rightarrow \{1,2,\ldots,\Delta\}$ such that, 
for every $i,j$, the duration of the fastest temporal path from $v_i$ to $v_j$ in the $\Delta$-periodic temporal graph $(G,\lambda,\Delta)$ is \emph{at least} $D_{i,j}$.}
\todo[inline]{NOT TEMPORALLY INTERESTING: the difficulty is to find a static graph with equal labels}

\todo[inline]{The matrix $D$ is m x m, and capturing the distances from an edge e to an edge f (zoom 14 Nov 22, GH).}
\todo[inline]{Check if the reduction works for the UPPER BOUNDED version (seems to work)}
\todo[inline]{how to extend the poly algorithms of cycles? Easy candidate: FES, FVS, series-parallel graphs, or tw=2 graphs}
\todo[inline]{FVS, $c$-factor approximation, hardness of approximation for $c<1.5$}

Let $v_1,v_2,\ldots,v_n$ be the $n$ vertices of the graph $G$ that we are looking for in the above problems. 
For simplicity of the presentation (and with a slight abuse of notation), we may refer during the paper to the entry $D_{i,j}$ of the matrix $D$ as 
$D_{a,b}$, where $a=v_i$ and $b=v_j$. That is, we might put as indices of the matrix $D$ the corresponding vertices of $G$ instead of their numbering.


\begin{definition}[$D$-increasing temporal path]
Let $(G,\lambda,\Delta)$ be a $\Delta$-periodic temporal graph on $n$ vertices, and let $D$ be an $n\times n $ matrix of positive integers. 
Let $P$ be a temporal path from $u_0$ to $u_k$ on the vertices $u_0,u_1,\ldots,u_k$, and let $P^\textsc{ST}=(u_0,u_1,\ldots,u_k)$ be the underlying \emph{static} path in $G$.
Then $P$ is \emph{$D$-increasing} in $G$ if $0=D_{u_0,u_0}<D_{u_0,u_1}<D_{u_0,u_2}<\ldots,D_{u_0,u_k}$.
\end{definition}


\begin{observation}
Let $D$ be \textsc{YES}-instance of \textsc{$(k,\Delta)$-TGR}, and let 
$(G,\lambda,\Delta)$ be a certificate for $D$, where $\lambda:E\rightarrow \{1,2,\ldots,\Delta\}^k$ a $\Delta$-periodic labeling of $G$.
Then, for every pair $u,v$ of vertices of $G$, every fastest temporal path from $u$ to $v$ is $D$-increasing.
\end{observation}

Let $(G,\lambda)$ be a temporal graph with  $n = |V(G)|$ and  $m=|E(G)|$.
Let $v \in V(G)$ be an arbitrary vertex of $G$, denote with $deg_{max}$ the maximum degree of all vertices in $V(G)$ and let $S_v$ be the set of time edges in $(G,\lambda)$, incident to $v$, \ie $S_v = \{(uv, \lambda(uv)) | uv \in E(G)\}$.
In their work Wo et.~al. \cite{Wu2016Efficient} provide an algorithm that computes the duration of the fastest temporal path from a source vertex $v$ to all other vertices in $G$ in
$O(n + m \log c)$ time, where $c = \min \{|S_v|, deg_{max}\}$.
From this result, we can deduce the following. 
\begin{lemma} \label{lemma:calculatingD}
Let $(G, \lambda, \Delta)$ be a $\Delta$-periodic temporal graph, where $\lambda$ assigns exactly $k$ labels to every edge of $G$. 
Denote with $deg_{max}$ the maximum degree of vertices in $G$, let $deg(v_i)$ be the degree of vertex $v_i \in V(G)$,
and let $c_{v_i} = \min \{ k \cdot deg(v_i), deg_{max}\}$.\\
To calculate the durations of all fastest temporal paths from a fixed vertex $v \in V(G)$ to all other vertices, it takes $O(n + m \log c_v)$ time. \\
To calculate the durations of the fastest temporal paths among all pairs of vertices we then need $O(n^2 + m \sum_{v \in V(G)} \log c_v)$ time.
\end{lemma}

Observe that $O(n + m \log c_v) = O(n + m \log deg_{max}) = O(n + m \log n) = O(n^2 \log n)$ and similarly
$O(n^2 + m \sum_{v \in V(G)} \log c_v) = O(n^2 + mn \log deg_{max}) = O(n + mn \log n) = O(n^3 \log n)$.
Since an instance $I$ of \kDeltaExact\ problem is an $n \times n$ matrix $D$, the running time of calculating one row of $D$ (\ie the fastest temporal paths from a single vertex to all others) takes $O(|I|\log \sqrt{|I|})$-time and calculating the whole matrix $D$ (\ie the fastest temporal paths among all pairs of vertices) takes $O(|I|^{3/2} \log \sqrt{|I|})$ time.
Therefore, from now on we say that calculating (a row of) $D$ takes polynomial time.

%\section{Results}

\section{
\texorpdfstring{\deltaExact\ } {Simple Delta-TGR}}

In this section we study the hardness of \deltaExact. We first start with defining certain notions, that will be of use when solving the problem.

    \begin{definition}[Travel delays]
    Let $(G, \lambda, \Delta)$ be a temporal graph satisfying conditions of problem \deltaExact.
    Let $e_1=uv$ and $e_2=vz$ be two incident edges in $G$ with $e_1 \cap e_2 = v$.
    We define the \emph{travel delay} from $u$ to $z$ at vertex $v$, denoted with $\tau_v^{uz}$,
    as the difference of the labels of $e_2$ and $e_1$, where we subtract the value of the label of $e_1$ from the label of $e_2$,  modulo~$\Delta$.
    More specifically:
    \begin{equation}\label{eq:def-VertexWaitingTime}
       \tau_v^{uz} \equiv \lambda (e_2) - \lambda(e_1) \pmod \Delta.
    \end{equation}
    Similarly, $\tau_v^{zu} \equiv \lambda (e_1) - \lambda(e_2) \pmod \Delta$.
    \end{definition}
    Intuitively, the value of $\tau_v^{uz}$ represents how long a temporal path waits at vertex $v$ when first taking the edge $e_1=uv$ and then the edge $e_2 = vz$.
    
    \begin{observation}\label{obs:travel-delays-both-directions}
    Let $(G, \lambda, \Delta)$ be a temporal graph satisfying conditions of problem \deltaExact.
    For any two incident edges $e_1 = uv$ and $e_2 = vz$ on vertices $u,v,z \in V$, with $e_1 \cap e_2 = v$, we have $\tau_v^{zu} = \Delta - \tau_v^{uz} \pmod \Delta$.
    \end{observation}
    
    \begin{proof}
        Let $e_1 = uv$ and $e_2 = vz$ be two edges in $G$ for which $e_1 \cap e_2 = v$. 
        By the definition $\tau_v^{uz} \equiv \lambda (e_2) - \lambda(e_1) \pmod \Delta$ and $\tau_v^{zu} \equiv \lambda (e_1) - \lambda(e_2) \pmod \Delta$.
        Summing now both equations we get $\tau_v^{uz} + \tau_v^{zu} \equiv \lambda(e_2) - \lambda(e_1) + \lambda (e_1) - \lambda(e_2) \pmod \Delta$, and therefore $\tau_v^{uz} + \tau_v^{zu} \equiv 0 \pmod \Delta$, which is equivalent as saying $\tau_v^{uz} \equiv - \tau_v^{zu} \pmod \Delta$ or $\tau_v^{zu} = \Delta - \tau_v^{uz} \pmod \Delta$.
    \end{proof}

\begin{claim} \label{claim:unique-fastest-path-allDelays}
    Let $(G, \lambda, \Delta)$ be a temporal graph satisfying conditions of problem \deltaExact,
    and let $P=P_{1,k}$ be a fastest temporal path from $u=v_1$ to $v=v_k$ on $k$ vertices $v_1,v_2,\dots,v_k$.
    Let us denote with $P_{1,i}$ the sub-path of temporal path $P_{1,k}$, that starts at $v_1$ and finishes at $v_i$.
    Suppose that $P_{1,i}$ is also the fastest temporal path from $u=v_1$ to any other vertex $v_i$ in $P$.
    Then we can determine travel delays on $P$ using the following equation
    \begin{equation}\label{eq:trav-delays-paths}
        \tau_{v_i}^{v_{i-1},v_{i+1}} = D_{1,i+1} - D_{1,i},
    \end{equation}
    for all $i \in \{2,3, \dots, k-1\}$.
\end{claim}

\begin{proof}
    Let $P$ be a fastest temporal path from $v_1$ to $v_k$ with the properties from the claim, and let $v_i$ be an arbitrary vertex in $P \setminus \{v_1,v_k\}$.
    Using the properties of fastest paths and the definition of duration, we can rewrite \cref{eq:trav-delays-paths} as follows
    \begin{align*}
        \tau_{v_i}^{v_{i-1},v_{i+1}} & = D_{1,i+1} - D_{1,i} =  d(P_{1,i+1}) - d(P_{1,i}) \\
        & = 
        \left(\lambda(v_{i}v_{i+1} - \lambda(v_1v_2) + 1\right) -  
        \left(\lambda(v_{i-1}v_{i} - \lambda(v_1v_2) + 1\right) \\
        & = \lambda(v_{i}v_{i+1}) - \lambda(v_{i-1}v_{i}),
        \end{align*}
    which is exactly the definition of $\tau_{v_i}^{v_{i-1},v_{i+1}}$.
\end{proof}

\subsection{
\texorpdfstring{\deltaExact\ } {Simple Delta-TGR}
is polynomial-time solvable on trees and paths}

Let $D$ be a matrix from \deltaExact, when the underlying graph $G$ of $D$ is a tree on $n$ vertices $\{v_1, v_2, \dots, v_n\}$.
Let $v_i,v_j$ be two arbitrary vertices in $G$. Then we know that there exists a unique (static) path $P$ among them.
Consequently, it follows that the temporal paths $P_{i,j}$ from $v_i$ to $v_j$ and $P_{j,i}$ from $v_j$ to $v_i$ are also unique, up to modulo of the period $\Delta$ of the labeling $\lambda$,
and therefore are the fastest.
Then $D$ is of the following form:
\begin{equation*}
    D_{i,j} =
    \begin{cases}
    0 & \text{if $i = j$}, \\
    1 & \text{if $v_i$ and $v_j$ are neighbours in G}\\
    d(P_{i,j}) & \text{else}
    \end{cases},
\end{equation*}
where $d(P_{i,j})$ is the duration of the (unique) temporal path $P_{i,j}$ from $v_i$ to $v_j$.

\begin{observation}\label{obs:travel-delays-in-trees}
    Let $v_i,v_j$  be arbitrary two vertices in a tree $G$. 
    Since there is a unique temporal path $P_{i,j}$ from $v_i$ to $v_j$, it is also the fastest one, therefore $d(P_{i,j}) = D_{i,j}$. 
    Note, all other vertices $v' \in P_{i,j} \setminus \{v_i,v_j\}$ are reached form $v_i$ using a part of the path $P_{i,j}$.
    Now using \cref{claim:unique-fastest-path-allDelays}, we can determine the waiting times for all \emph{inner} vertices of the path $P_{i,j}$.
\end{observation}

\begin{theorem} \label{thm:deltaExact-PolyTimeTrees}
    \deltaExact\ can be solved in polynomial time on trees.
\end{theorem}

\begin{proof}
    Let $D$ be an input matrix for problem \deltaExact of dimension $n \times n$.
    Let us fix the vertices of the corresponding graph $G$ of $D$ as $v_1, v_2, \dots, v_n$, where vertex $v_i$ corresponds to the row and column $i$ of matrix $D$.
    This can be done in polynomial time as we need to read through the matrix $D$ once and connect vertices $v_i, v_j$ for which $D_{i,j} = 1$. At the same time we also check if $D_{i,i} = 0$, for all $i \in [n]$.
    When $G$ is constructed we run DFS algorithm on it and check if it has no cycles.
    If at any step we encounter a problem, our algorithm stops and returns a negative answer.
    
    From now on we can assume that we know that the underlying graph $G$ is a tree and we know how it looks like.
    For the next part of the algorithm we use \cref{obs:travel-delays-in-trees}.
    
    For a vertex $v_i$ we check which vertex $v_j \in G$ is furthest away from it, \ie for which vertex $v_j$ the entry $D_{i,j}$ is maximum.
    We now take the unique (fastest) temporal path $P_{i,j}$ and using \cref{obs:travel-delays-in-trees} calculate waiting times at all inner vertices.
    We save those values in a matrix $T$ and mark vertices of the path  $P_{i,j}$ as visited.
    Matrix $T$ stores at the position $(i,i-1,i+1)$ the value corresponding to the travel delay at vertex $v_i$ when traveling from $v_{i-1}$ to $v_{i}$, \ie $\tau_{v_i}^{v_{i-1}, v_i}$, whenever $v_{i-1}v_i, v_iv_{i+1} \in E(G)$. All other values of $T$ are set to \textsc{Null}.
    Now we repeat procedure, from vertex $v_i$, for vertices that are not marked as visited yet, \ie vertices in $V \setminus P_{i,j}$.
    We find a vertex in $V \setminus P_{i,j}$ that is furthest away from $v_i$ and repeat the procedure.
    When we have exhausted the $i$-th row of $D$, corresponding to the vertex $v_i$,
    we continue and repeat the procedure for all other vertices.
    If at any point we get two different values for the same travel delay at a specific vertex, then we stop with the algorithm and return the negative answer.
    If the above procedure finishes successfully we get the matrix $T$ with travel delays for all vertices $v_i$ in the tree, of degree at least $2$.
    The above calculation is performed in polynomial time, as for every vertex $v_i$ we inspect the whole graph once.
    \begin{claim}\label{claim:matrixT-travelDelays-tree}
        Matrix $T$ consists of travel delays of all vertices of degree at least $2$ in $G$.
    \end{claim}
    \begin{proof}[Proof of \cref{claim:matrixT-travelDelays-tree}]
        Note, by the definition of travel delays, a vertex of degree $1$ cannot have a travel delay.
        Suppose now that there is a vertex $v_i \in V(G)$ of degree at least $2$, for which our algorithm did not calculate its travel delay.
        Let $v_a, v_b$ be two arbitrary neighbors of $v_i$, \ie $v_a v_i, v_i v_b \in E(G)$.
        Since $G$ is a tree, the unique (and fastest) temporal path from $v_a$ to $v_b$ passes through $v_i$.
        When our algorithm was inspecting the row of $D$ corresponding to the vertex $v_a$, it had to consider the temporal path from $v_a$ to $v_b$. 
        At this point, it calculated $\tau_{v_i}^{v_a,v_b}$. 
        Since this is true for any two $v_a, v_b \in N(v_i)$, it cannot happen that some travel delay at $v_i$ is not calculated.
        Since $v_i$ was an arbitrary vertex in $G$ of degree at least $2$, the claim holds.
    \end{proof}
    
    Now, given the matrix of travel delays $T$, we can find a labeling $\lambda$ that satisfies $D$.
    We start by fixing a label of one edge as $a$, where $a \in [\Delta]$.
    Knowing the label of the edge $v_1v_2$ and all waiting times in $T$, we can uniquely determine the labels of all other edges.
    More specifically, if we know that $\lambda(v_i v_j) = a$, then for all $v_k \in N(v_i)$ (resp.~$v_{k'} \in N(v_j)$)
    the value $\lambda(v_iv_k) \equiv a + \tau_{v_i}^{v_j,v_k} \pmod \Delta $ (resp.~$\lambda(v_j v_{k'}) \equiv a + \tau_{v_j}^{v_i,v_{k'}} \pmod \Delta $).
    Since there are $\Delta$ options to fix the first label, we can find $\Delta$ different labelings satisfying $D$.
    Note, w.l.o.g we can start determining the labeling $\lambda$ by setting $\lambda(v_1v_2) = 1$.
    It is not hard to see, that also the calculation of the labeling $\lambda$ takes polynomial time, as we have to traverse the graph exactly once, to successfully fix the labeling. Therefore all together the whole algorithm is performed in polynomial time.
\end{proof}

\subsection{
\texorpdfstring{\deltaExact\ } {Simple Delta-TGR}
is polynomial-time solvable on cycles}

Let us observe some properties of the matrix $D$ from \deltaExact, when the underlying graph $G$ of $D$ is a cycle $C_n = \{v_1, v_2, \dots, v_n\}$  on $n$ vertices.
By the definition, each vertex is on distance $0$ from itself. This corresponds with all diagonal entries of $D$ being $0$.
Now, let us observe that each vertex $v_i$ has exactly two neighbours in $C_n$, namely $v_{i-1}$ and $v_{i+1}$,
therefore for all $i\in [n]$ we set $D_{i,i-1} = D_{i, i+1} = 1$, where indices are taken modulo $n$.
This results in the upper and lower diagonal of $D$ having all $1$'s, together with $D_{1,n} = D_{n,1} = 1$.
The matrix $D$ is of the following form
\begin{equation*}
  D = 
  \begin{bmatrix}
    0 & 1 &  &  &  & 1\\
    1 & 0 & 1 &  &  & \\
    & 1 & 0 & 1 & & \\
    & & \ddots & \ddots & \ddots &   \\
    &   & &1 &  0 & 1\\ 
    1 &  &  &  &1 &  0 
  \end{bmatrix},
\end{equation*}
where the empty entries consists of positive integers different than $1$.

Given a matrix in the input of \deltaExact\ we can check in $O(n^2)$ time if it is of correct form, by traversing it once. If it is not of correct for, our algorithm stops and returns the negative answer.
From now on, we will assume, that the input matrix is of correct form.

Let $v_i$ be an arbitrary vertex in the cycle $C_n =\{v_1, v_2, \dots, v_n\}$.
Vertex $v_i$ can reach an arbitrary vertex $v_k \in C_n$ using a positive side of the cycle (\ie going from $v_i$ to $v_{i+1},  v_{i+2}$, etc.), 
and using the negative side of the cycle (\ie going from $v_i$ to $v_{i-1}, v_{i-2}$, etc.).
Let us denote with the $d^+(i,k)$ the duration of the temporal path from $v_i$ to $v_k$ using the positive side of the cycle,
and with $d^-(i,k)$, the duration of the temporal path from $v_i$ to $v_k$ using the negative side of the cycle.
Since these two are the only possible paths from $v_i$ to $v_k$ in $C_n$ we know that $D_{i,k} = min \{d^+(i,k), d^-(i,k)\}$.

\begin{claim} \label{claim:poly-delta-cycle-monotonicity}
    If vertex $v_i$ reaches vertex $v_j$ the fastest, using the positive (resp.~negative) side of the cycle, \ie $v_i, v_{i+1}, \dots, v_{j-1}, v_j$ (resp. $v_i, v_{i-1}, \dots, v_{j+1}, v_j$),
    then $v_i$ reaches all other vertices $v_k$, where $k \in \{i+1, i+2, \dots, j-1\}$ (resp.~ $k \in \{i-1, i-2, \dots, j+1\}$)
    using the same, positive (resp.~negative) side of the cycle,
    where the indices are taken modulo $n$.
\end{claim}
\begin{proof}
    Let $v_i, v_j$ be two arbitrary vertices in $C_n$ and suppose that $D_{i,j} = d^+(i,j)$,
    but there exists a vertex $v_k$ from $C_n$, where $k \in \{i+1, i+2, \dots, j-1\}$,
    for which $D_{i,k} \neq d^+(i,k)$.
    Then $d^-(i,k)$ passes through the vertex $v_j$, and we can split the path from $v_i$ to $v_k$ into two pieces, 
    first from $v_i$ to $v_j$ and the second one from $v_k$ to $v_j$.
    So 
    \begin{equation} \label{eq:poly-delta-cycle-monotonicity}
        d^-(i,k) = d^-(i,j) + d^-(j,k)^*,
    \end{equation} where $d^-(j,k)^*$ is the duration of the path from $v_j$ to $v_k$, using the negative side of the cycle, with consideration that we come to the vertex $v_j$ at time $d^-(i,j)$ and we potentially have to wait there for some positive amount of time, before we continue to $v_j$
    (\ie $d^-(j,k)^* \geq d^-(i,j) \geq D_{j,k}$ includes some waiting time at vertex $v_j$).
    By the assumption we know that $d^+(i,j) \leq d^-(i,j)$, so we can rewrite \cref{eq:poly-delta-cycle-monotonicity} as
    $d^-(i,k) \leq d^+(i,j) + d^-(j,k)^*$. This means that we can reach $v_k$ from $v_j$ by going from $v_i$ to $v_j$ using the positive side of the cycle, wait some time at $v_j$, before we continue back to $v_j$.
    In the above construction vertex $v_k$ is visited twice. By the definition, the fastest temporal path from $v_i$ to $v_k$ visits $v_k$ exactly once. Therefore we can stop at $v_k$ already when traveling from $v_i$ to $v_j$ the first time, using the positive side of the cycle.
    It follows that $D_{i,j} = d^+(i,j) \leq d^-(i,j)$, which contradicts with our assumption.
\end{proof}

Let $v_i$ and $v_j$ be two arbitrary vertices in the cycle $C_n$, for which $v_i v_j \notin E(C_n)$.
Suppose that $P^+_{i,j}$ (resp.~$P^-_{i,j})$ is the fastest temporal path from $v_i$ to $v_j$, using the positive (resp.~negative) side of the cycle, 
\ie $v_i, v_{i+1}, \dots, v_{j-1}, v_j$ (resp. $v_i, v_{i-1}, \dots, v_{j+1}, v_j$).
Then by \cref{claim:poly-delta-cycle-monotonicity} and \cref{claim:unique-fastest-path-allDelays},
we get that we can determine all travel delays at vertices of $P^+_{i,j} \setminus \{v_i, v_j\}$ (resp.~$P^-_{i,j} \setminus \{v_i, v_j\}$).


Let $v_i$ be an arbitrary vertex of $C_n$. Let us look at the row $i$ of the matrix $D$, which corresponds to the durations of fastest temporal paths from $v_i$ to all other vertices $v_j \in C_n$.
Using \cref{claim:poly-delta-cycle-monotonicity} we know that $v_i$ will reach some consecutive vertices $v_{i+1}, v_{i+2}, \dots, v_j$ the fastest, using the positive side of the cycle 
and $v_{i-1}, v_{i-2}, \dots, v_{j+1}$ the fastest, using the negative side of the cycle.
Suppose $v_j \in C_n$ is the last vertex $v_i$ reaches using the positive side of the cycle, and $v_{j+1}$ the last vertex that is reached using the negative side of the cycle.
Then we know that $D_{i,i+1} < D_{i,i+2} < \cdots< D_{i,j-1} < D_{i,j}$ and 
$D_{i,i-1} < D_{i,i-2} < \cdots < D_{i,j+2} < D_{i,j+1}$.
Note that it can happen that $v_j = v_{j+1}$, \ie to reach vertex $v_j$ from $v_i$ the fastest, we can use either positive or negative side of the cycle.
Using the above observations, every row $i$ ($i \in [n]$) of matrix $D$ has two (or one) maximum elements, one at position $j$ and the other at position $j+1$, where $j, j+1 \in [n]$ and the indices are considered modulo $n$.
Let us denote these two values as $m_i^1$ and $m_i^2$.
The row $i$ of $D$ is of the following form, it has a $0$ at the entry $i$, it has $1$ at entries $i-1, i+1$,
the values increase on the positions $i+1, i+2, i+3, \dots, j-1, j$ for some $j$ with value $m_i^1$, 
and on the other side, values increase on the positions $i-1, i-2, i-3, \dots, j+2, j+1$ for some $j+1$ with value $m_i^2$,
where indices are taken modulo $n$.

Knowing this, we can split the vertices $v_j \in V(C_n) \setminus \{v_i\}$ into two parts, ones that are reached from $v_i$ the fastest using the positive side of the cycle and ones that are reached using the negative side of the cycle.
To determine these two sets we do the following.
We fix a vertex $v_i \in C_n$ and check its corresponding row in the matrix $D$. 
We determine two max values $m_i^1$ and $m_i^2$ at positions $j$ and $j+1$ (modulo $n$), respectively,
for which it has to hold that
$D_{i,i+1} < D_{i,i+2} < \cdots< D_{i,j-1} < D_{i,j}=m_i^1$ and 
$D_{i,i-1} < D_{i,i-2} < \cdots < D_{i,j+2} < D_{i,j+1}=m_i^2$.
Note, it can also happen that $m_i^1 = m_i^2$. 
Now denote the path that uses the positive side of the cycle, from $v_i$ to $v_j$, as $P^+_i$ and
the path that uses the negative side of the cycle, from $v_i$ to $v_{j+1}$, as $P^-_i$.
By \cref{claim:poly-delta-cycle-monotonicity} and \cref{claim:unique-fastest-path-allDelays} we can calculate travel delays at every vertex $v_k \in C_n \setminus \{v_i, v_j, v_{j+1}\}$,
which we store in a list $T$ of length $n$,
where the entry at the position $k$ corresponds to the travel delay at vertex $v_k$ when traveling from $v_{k-1}$ to $v_{k+1}$.
Note, from \cref{obs:travel-delays-both-directions} it follows, that it is enough to store the value of the travel delay in one direction (\ie knowing $\tau_v^{u,w}$ we know also $\tau_v^{w,u}$).
We repeat the above procedure for all rows in the matrix $D$, \ie for all vertices $v_i \in C_n$.
Calculation in one row is performed in $O(n)$ time, repeating it for all rows we need $O(n^2)$ time.

To determine the labeling $\lambda$ satisfying the matrix $D$, we have to make sure that we have calculated travel delays for all vertices.

\begin{claim}
List $T$ of travel delays has non-empty values at all positions, \ie we have successfully calculated travel delays for all vertices.
\end{claim}
\begin{proof}
    Throughout the proof we
    denote with $d^+(i,j)$ the duration of the temporal path that starts at $v_i$ and finishes at $v_j$, that uses the positive side of the cycle $C_n$,
    and similarly with $d^-(i,j)$ the duration of the temporal path that starts at $v_i$ and finishes at $v_j$, that uses the negative side of the cycle $C_n$,
    where indices are taken modulo $n$.
    
    Suppose for the contradiction that the statement of the claim does not hold. Then there exists a vertex $v_i \in C_n$, for which we did not calculate its travel delay.
    Let $v_j \in C_n \setminus \{v_i\}$ be an arbitrary vertex. 
    Note that the only time we cannot calculate the travel delay at vertex $v_i$, when considering vertex $v_j$, is in this case when $v_i$ is one of the maximum elements in $D_j$, \ie $v_i$ is a vertex that is on a maximum duration from $v_j$.
    This has to hold for all vertices $v_j$, therefore $v_i$ has to be on the maximum distance from every vertex $v_j \in C_n \setminus \{v_i\}$.
    It then also has to hold for vertices $v_{i-1}, v_{i+1}$, that are neighbours of $v_i$.
    We know that in this case $d^+(i-1,i) = 1, d^-(i+1,i) = 1$.
    Since $v_i$ has to be on the maximum duration from both of them 
    (\ie is one of the two maximum values $m^1_{i-1}, m^2_{i-1}$ for vertex $v_{i-1}$ and one of the two maximum values $m^1_{i+1}, m^2_{i+1}$ for vertex $v_{i+1}$),
    we know that 
    \begin{align}\label{eq:cycle-travel-delays-all}
        & d^+(i+1,i-1) < d^-(i+1,i-1) & \text{and}\\
        & d^-(i-1,i+1) < d^+(i-1,i+1).
    \end{align}
    If this would not hold, the fastest path would go through $v_i$ and we would be able to calculate the travel delay at $v_i$.
    
    Denote the labels $\lambda(v_{i-1}v_i) = a, \lambda(v_{i}v_{i+1})=a'$, and $\lambda(v_{i-2}v_{i-1} = b, \lambda (v_{i+1}v_{i+2})=b'$, where $a,a',b,b' \in [\Delta]$.
    W.l.o.g. we can suppose that $a \geq a'$.
    Therefore, using the definition for the duration of temporal paths, we get that
    $d^+(i+1,i-1) = (k \delta + b) - b' + 1$, where $k$ is some non-negative integer, and $d^-(i+1,i-1) = a - a' + 1$.
    Using the first inequality from \cref{eq:cycle-travel-delays-all} we get that 
    $(k \delta + b) - b' +1 < a - a' + 1$ which is equivalent to $(k \delta + b) - b' < a - a'$, which can be true only when $k = 0$, but because the duration is positive we get that $b > b'$ and
    $b - b' < a - a'$.
    Now again using the definition of the duration, we get
    $d^+(i-1,i+1)= (k\delta + a') - a + 1$, where $k$ is some non-negative integer, but since $v_{i-1}v_i$ and $v_iv_{i+1}$ are incident edges, we know also that $k=1$, therefore $d^+(i-1,i+1)= \delta + a - a + 1$. 
    Again by the definition, $d^-(i-1,i+1) = (k' \delta + b') -b + 1$, for some non-negative integer $k'$.
    Using the second inequality from \cref{eq:cycle-travel-delays-all} we get that 
    $(k' \delta + b') -b + 1 < \delta + a - a + 1$.
    Which is equivalent to  $(k' \delta + b') -b < \delta + a' - a $. This can hold only when $k' = 1$, in that case we get $ \delta + b' -b < \delta + a' - a $ which is equivalent to $b' -b < a' - a$.
    This is in the contradiction with the inequality  $b - b' < a - a'$ as this is equivalent to $b'-b > a'-a$.
    
    Therefore it cannot happen that there is a vertex $v_i$ for which we cannot calculate its travel delay in $C_n$.
\end{proof}

All of the above observations imply the following result.
\begin{theorem}
    \deltaExact\ can be solved in polynomial time on cycles.
\end{theorem}

\begin{proof}
As stated above, we can determine travel delays at every vertex in $O(n^2)$ time. 
Once all of the delays are calculated, we have to only construct the labeling $\lambda$ that satisfies the matrix $D$. 
We start by fixing a label of one edge as $a$, where $a \in [\Delta]$.
Knowing the label of the edge $v_1v_2$ and all waiting times in $T$, we can uniquely determine the labels of all other edges.
More specifically, if we know that $\lambda(v_i v_j) = a$, then for all $v_k \in N(v_i)$ (resp.~$v_{k'} \in N(v_j)$)
the value $\lambda(v_iv_k) \equiv a + \tau_{v_i}^{v_j,v_k} \pmod \Delta $ (resp.~$\lambda(v_j v_{k'}) \equiv a + \tau_{v_j}^{v_i,v_{k'}} \pmod \Delta $).
Since there are $\Delta$ options to fix the first label, we can find $\Delta$ different labelings satisfying $D$.
Note, w.l.o.g we can start determining the labeling $\lambda$ by setting $\lambda(v_1v_2) = 1$.
\end{proof}

    
\section{Hardness of Exact Realization}

\todo[inline]{HM: For the following hardness I assume that we only consider strict temporal paths. (NK: Yes you are right, all paths are strict, sorry forgot to specify). \\
Furthermore, I can currently only make it work if we do not have periods ($\Delta=\infty$). I am not sure the idea also works if we have periods.}

\begin{theorem}
	\textsc{Exact Realization $(\infty)$} is \NP-hard.
\end{theorem}

\begin{proof}
	We present a polynomial-time reduction from the NP-hard problem 3-SAT~\cite{Karp1972Reducibility}. Here, we are given a formula $\phi$ in conjunctive normal form, where each clause contains exactly 3 literals (with three distinct variables). We construct an instance of \textsc{Exact Realization $(\infty)$} as follows.

 We start by describing the vertex set of the underlying graph $G$.
\begin{itemize}
\item For each variable $x$ in $\phi$, we create three variable vertices $x, x^T, x^F$.
\item For each clause $c$ in $\phi$, we create one clause vertex $c$.
\item We add one additional super vertex $v$.
\end{itemize}
Next, we describe the edge set of $G$.
\begin{itemize}
\item For each variable $x$ in $\phi$ we add the following five edges: 

$\{x, x^T\}, \{x, x^F\}, \{x^T, x^F\}, \{x^T, v\}, \{x^F,v\}$.
\item For each pair of variables $x,y$ in $\phi$ with $x\neq y$ we add the following four edges 

$\{x^T,y^T\},\{x^T,y^F\}, \{x^F,y^T\},\{x^F,y^F\}$.
\item For each clause $c$ in $\phi$ we add one edge for each literal. Let $x$ appear in $c$. If $X$ appears non-negated in $c$ we add edge $\{c,x^T\}$. If $x$ appears negated in $c$ we add edge $\{c, x^F\}$.
\end{itemize}
This finishes the construction of $G$.

Now we specify the distances between all vertex pairs. Naturally, the distance between all pairs of adjacent vertices is one.
\begin{itemize}
    %\item For each variable $x$ in $\phi$ we specify the following distances between the non-adjacent variable vertices:
    
    %$d(x_1,x_2)=2$. 
    %\item For pair of variable $x,y$ in $\phi$ with $x\neq y$ we specify the following distances:

    %$d(x_1,y^T)=d(x_1,y^F)=3$, $d(x_2,y^T)=d(x_2,y^F)=2$.
    \item For each variable $x$ in $\phi$ we specify the following distances to the super vertex $v$:

    $d(x,v)=2$. %, $d(x_2,v)=3$.

    \item For each clause $c$ in $\phi$ we specify the following distances to the super vertex $v$:

    $d(c,v)=2$
    \item Let $x$ be a variable that appears in clause $c$, then  we specify the following distances:

    $d(c,x)=2$.
    
    If $x$ appears non-negated in $c$ we specify the following distances:

    $d(c,x_F)=2$.

    If $x$ appears negated in $c$ we specify the following distances:

    $d(c,x_T)=2$.
    \item Let $x$ be a variable that does \emph{not} appear in clause $c$, then we specify the following distances:

    $d(c,x^T)=d(c,x^F)=2$.
\end{itemize}
All distances between non-adjacent vertex pairs that are not defined above are set to $\infty$.

This finishes the construction of the \textsc{Exact Realization $(\infty)$} which can clearly be done in polynomial time. In the remainder we show that it is a yes-instance if and only if $\phi$ is satisfiable.

$(\Rightarrow)$: Assume the constructed \textsc{Exact Realization $(\infty)$} is a yes-instance. Then there exist a label $\lambda(e)$ for each edge $e\in E(G)$ such that for each vertex pair $u,w$ in the temporal graph $(G,\lambda)$ we have that a fastest temporal path between from $u$ to $w$ has exactly duration $d(u,w)$. In particular, for any two vertices $u,w$ with $d(u,w)=\infty$ we have that there does not exist a temporal path from $u$ to $w$ in $(G,\lambda)$.

We construct a satisfying assignment for $\phi$ as follows. For each variable $x$, if $\lambda(\{x,x^T\})=\lambda(\{x^T,v\})$, then we set $x$ to \texttt{true}, otherwise we set $x$ to \texttt{false}.

To show that this yields a satisfying assignment, we need to show some following properties of $\lambda$.
First, observe that adding some integer $t$ to all time labels does not change the duration of any temporal path. Second, observe that if for two vertices $u,w$ we have that $d(u,w)$ equals the distance between $u$ and $w$ in $G$, then there is a shortest path from $u$ to $w$ in $G$ such that $\lambda$ puts consecutive time labels on the edges of that shortest path. 


Let $\lambda(\{x,x^T\})=t$ and $\lambda(\{x,x^F\})=t'$, for an arbitrary variable $x$. 
If both $\lambda(\{x^T,v\})\neq t+1$ and $\lambda(\{x^F,v\})\neq t'+1$, then $d(x,v)>2$, which is a contradiction. 
Thus, for every variable $x$, we have that $\lambda(\{x^T,v\})= t+1$ or $\lambda(\{x^F,v\})= t'+1$ (or both). 
In particular, this means that if $\lambda(\{x,x^F\})=\lambda(\{x^F,v\})$, then we set $x$ to \texttt{false}, since in this case $\lambda(\{x,x^T\})\neq\lambda(\{x^T,v\})$.

%Furthermore, we have that if $x$ appears non-negated in clause $c$, then $\lambda(\{c,x^T\})=t-1$, otherwise we have $d(c,x^T)>2$. Symmetrically, we have that if $x$ appears negated in clause $c$, then $\lambda(\{c,x^F\})=t'-1$, otherwise we have $d(c,x^F)>2$.

Now assume for contradiction that the described assignment is not satisfying. Then there exists a clause $c$ that is not satisfied. Recall that we require $d(c,v)=2$. Hence, we must have a temporal path consisting of two edges from $c$ to $v$ such that the two edges have consecutive labels. By construction of $G$ there are three candidates for such a path, one for each literal of $c$. 
Assume w.l.o.g\ that $x$ appears in $c$ non-negated (the case of a negated appearance of $x$ is symmetrical) and that the temporal path realizing $d(c,v)=2$ goes through vertex $x^T$. 
Then we have that $\lambda(\{c,x^T\})=\lambda(\{x^T,v\})-1$. Furthermore, since $d(c,x)=2$ we also have that $\lambda(\{c,x^T\})=\lambda(\{x,x^T\})-1$. It follows that $\lambda(\{x,x^T\})=\lambda(\{x^T,v\})$. However, this implies that $x$ is set to \texttt{true} in the satisfying assignment and thus the clause $c$ is satisfied, a contradiction. 


%Assume w.l.o.g.\ that variable $x$ appears non-negated in clause $c$. Then we have that $\{c,x^T\}\in E(G)$. Assume that $\lambda(\{c,x^T\})=t$. Recall that we have specified $d(c,x_2)=2$. Hence we have that $\lambda(\{x_2,x^T\})=t+1$.

$(\Leftarrow)$: Assume that $\phi$ is satisfiable. Then there exists a satisfying assignment for the variables in $\phi$.

We construct a labeling $\lambda$ as follows.
\begin{itemize}
    \item All edges incident with a clause vertex $c$ obtain label one.
    %\item For each variable $x$, we set $\lambda(\{x^T,x^F\})=1$.
    \item If variable $x$ is set to \texttt{true}, we set $\lambda(\{x^F,v\})=3$.
    \item If variable $x$ is set to \texttt{false}, we set $\lambda(\{x^T,v\})=3$.
    \item We set the labels of all other edges to two.
\end{itemize}

Next, we verify that all distances are realized.
\begin{itemize}
    \item For each variable $x$ in $\phi$ we have $d(x,v)=2$: 
    
    If $x$ is set to \texttt{true}, then there is a temporal path from $x$ to $v$ via $x^F$ such that $\lambda(\{x,x^F\})=2$ and $\lambda(\{x^F,v\})=3$. If $x$ is set to \texttt{false}, then there is a temporal path from $x$ to $v$ via $x^T$ such that $\lambda(\{x,x^T\})=2$ and $\lambda(\{x^T,v\})=3$.

    \item For each clause $c$ in $\phi$ we have that $d(c,v)=2$:

    Since we have a satisfying assignment there is a variable $x$ appearing in $c$ that is set to a truth-value that satisfies $c$. If $x$ appears non-negated in $c$ (and hence is set to \texttt{true}), then there is a temporal path from $c$ to $v$ through $x^T$ such that $\lambda(\{c,x^T\})=1$ and $\lambda(\{x^T,v\})=2$. If $x$ appears negated in $c$ (and hence is set to \texttt{false}), then there is a temporal path from $c$ to $v$ through $x^F$ such that $\lambda(\{c,x^F\})=1$ and $\lambda(\{x^F,v\})=2$.
    \item Let $x$ be a variable that appears in clause $c$.
    If $x$ appears non-negated in $c$ we have $d(c,x)=d(c,x_F)=2$:

    There is a temporal path from $c$ to $x$ via $x^T$ and also a temporal path from $c$ to $x^F$ via $x^T$ such that $\lambda(\{c,x^T\})=1$ and $\lambda(\{x,x^T\})=\lambda(\{x^T,x^F\})=2$.

    If $x$ appears negated in $c$ we have $d(c,x)=d(c,x_T)=2$:

    There is a temporal path from $c$ to $x$ via $x^F$ and also a temporal path from $c$ to $x^T$ via $x^F$ such that $\lambda(\{c,x^F\})=1$ and $\lambda(\{x,x^F\})=\lambda(\{x^T,x^F\})=2$.
    \item Let $x$ be a variable that does \emph{not} appear in clause $c$, then we have $d(c,x^T)=d(c,x^F)=2$:

    Let $y$ be a variable that appears non-negated in $c$ (the case where $y$ appears negated is symmetrical). Then there is a temporal path from $c$ to $x^T$ via $y^T$ and also a temporal path from $c$ to $x^F$ via $y^T$ such that $\lambda(\{c,y^T\})=1$ and $\lambda(\{y^T,x^T\})=\lambda(\{y^T,x^F\})=2$.
\end{itemize}
Lastly, we show that all non-adjacent vertex pairs $u,w$ with $d(u,w)=\infty$ are not temporally connected in $(G,\lambda)$.
\begin{itemize}
\item For all pairs of clause vertices $c,c'$ we have $d(c,c')=\infty$: 
\todo[inline]{New matrix entries D for period Delta: d(c,c')=Delta+1 (using three edges, with labels L, L+1, L).}

Since all edges incident with clause vertices have label one and clause vertices are pairwise non-adjacent, there cannot be a temporal path from one clause vertex to another.
\item For all variable vertices $x$ and clause vertices $c$ we have $d(x,c)=\infty$:
\todo[inline]{New matrix entries D for period Delta: if x appears (negated or not) in c, then d(x,c)=Delta (using two edges, with label L+1, L). Otherwise D(x,c)=2Delta (using three edges, with labels L, L, L-1).}

Since all edges incident with variable vertices $x$ have label two and all edges incident with clause vertices $c$ have label one, there cannot be a temporal path from a variable vertex $x$ to a clause vertex $c$.
\item For all pairs of variable vertices $x,y$ we have $d(x,y)=\infty$:
\todo[inline]{New matrix entries D for period Delta: d(x,y)=2Delta+1 (using three edges, each with the same label).}

Since all edges incident with variable vertices $x$ have label two and variable vertices $x$ are pairwise non-adjacent, there cannot be a temporal path from one variable vertex to another.
\item For all pairs of variable vertices $x,y$ we have $d(y^T,x)=d(y^F,x)=\infty$:
\todo[inline]{New matrix entries D for period Delta: $d(y^T,x)=d(y^F,x)=Delta+1$ (using two edges, with equal labels).}

Since all edges incident with variable vertices $x$ have label two and all edges incident with variable vertices $y^T, y^F$ have labels two or three and variable vertices $x$ are non-adjacent to variable vertices $y^T,y^F$, there cannot be a temporal path from a variable vertex $y^T$ or $y^F$ to variable vertex $x$.
\item For all pairs of variable vertices $x,y$ we have $d(x,y^T)=d(x,y^F)=\infty$:
\todo[inline]{New matrix entries D for period Delta: $d(x,y^T)=d(x,y^F)=Delta+1$ (using two edges, with equal labels).}

Observe that edges incident with $y^T, y^F$ that have label three connect $y^T, y^F$ to $v$. Furthermore, $v$ has distance two from $x$ in the unlabeled graph $G$. Since all edges incident with variable vertices $x$ have label two, there is no temporal path starting at $x$ and arriving at $v$ at time two, that could then continue to $y_T$ or $y_F$ using an edge with label three. Hence, there is no temporal path from $x$ to $y^T, y^F$ using an edge with label three. Since all edges incident with $x$ have label two and variable vertices $x$ are non-adjacent to variable vertices $y^T,y^F$, there cannot be a temporal path from variable vertex $x$ to variable vertex $y^T$ or $y^F$.
\item For all variable vertices $x$ and clause vertices $c$ we have $d(v,x)=d(v,c)=\infty$:
\todo[inline]{New matrix entries D for period Delta: d(v,x)=Delta (using two edges, with labels L+1,L). 
New matrix entries D for period Delta: d(v,c)=Delta (using two edges, with labels L,L-1).}

All edges incident with $v$ have labels two or three. All edges incident with $x$ have label two and all edges incident with $c$ have label one. We immediately have that there is no temporal path from $v$ to $c$. Furthermore, since $x$ and $v$ are non-adjacent, we also have that there is no temporal path from $v$ to $x$.
\end{itemize}
\end{proof}

\section{FPT and W[1]-hardness of exact realization}
In a graph $G=(V,E)$, a \emph{feedback edge set} $F \subset E(G)$ is a subset of edges, such that each cycle in $G$ has at least one edge in $F$.
The minimum such set $F$ is called a  \emph{minimum feedback edge set} and its size, $k = |F|$, is called the \emph{feedback edge number} of graph $G$.
Note that one can find a minimum feedback edge set in linear time, by calculating a spanning tree (or forest) $T$ of the given graph $G$ and then removing all of the edges $T$ from $G$, \ie $F = E(G) \setminus E(T)$.

\begin{theorem}\label{thm:FPTwrtFES}
    \deltaExactLong\ is FPT parameterized by the feedback edge number.
\end{theorem}

Before we start with the proof we fix the following notation. 
Let $D$ be the input matrix of \deltaExact\ \ie
the matrix of the fastest temporal paths among $n$ vertices, and let $G$ be its underlying graph, on $n$ vertices and $m$ edges.
Let $F$ be a minimum feedback edge set of $G$ and let $k$ be the feedback edge number of $G$.

We now introduce an algorithm that determines the labeling of $G$, satisfying $D$, that runs in $f(k) \cdot \text{poly}(n)$ time.
Our algorithm performs the following steps.
\begin{enumerate}
    \item Create $G'$ and $D'$ from $G$ and $D$ respectively, by removing all degree $1$ vertices from $G$ and $D$.
    \item Compute a minimum feedback edge set $F$ in $G'$ (note, $F$ is also a minimum feedback edge set of $G$).
    \item Determine vertices of interest $U$ of the graph $G'$.
    \item \label{enum:FPT-labelingVerticesOfInterest} Guess the (partial) labeling $\lambda$ of $G'$, that connects all pairs of vertices from $U$, satisfying their respective values in $D'$.
    \item \label{enum:FPT-labelingraphNoLeafs} Extend the partial labeling $\lambda$ to the labeling of the whole $G'$, respecting $D'$.
    \item \label{enum:FPT-labelingWholeGraph} Extend the labeling $\lambda$ of $G'$ to the labeling of $G$, respecting $D$.
\end{enumerate}
It is important to point out, that in step~\ref{enum:FPT-labelingVerticesOfInterest}, our algorithm does not build a labeling satisfying conditions in this step,
and then tries to extend it in steps~\ref{enum:FPT-labelingraphNoLeafs} and \ref{enum:FPT-labelingWholeGraph},
but it
builds an integer linear program (ILP) problem with $O(k)$ variables,
with restrictions satisfying condition from steps~\ref{enum:FPT-labelingVerticesOfInterest}--\ref{enum:FPT-labelingWholeGraph}.
For each of the steps we now argue its correctness and time complexity.

\subsection{Steps 1 -- 3 of the FPT algorithm}
In the first step of the algorithm we create an instance $D'$, with the underlying graph $G'$, from $D$ and $G$, by simply removing all the vertices of degree one from $G$ and their corresponding rows and columns from the matrix $D$. 
This step is executed in $O(n+m)$ time.
Since we determine the labels of edges in $G \setminus G'$ in the last step, the whole solution is not affected by performing this step.

In the second step,
we determine a minimum feedback edge set $F$ of $G'$ by finding a spanning tree $T$ of $G'$ and set $F = E(G) \setminus E(T)$. 
We can perform this step in linear time.

In the third step we determine the set $U$ of \emph{vertices of interest}.
Let $T$ be a spanning tree of $G'$, with $F$ being the corresponding feedback edge set of $G'$.
Let $V_1 \subset V(G')$ be the set of leaves in $T$, $V_2 \subset V(G')$ be the set of vertices of degree two in $T$, that are incident to some edges in $F$, and let $V_3 \subset V(G')$ be the set of vertices of degree at least $3$ in $T$. 
Then $|V_1| + |V_2| \leq 2k$, since every leaf in $T$ and every vertex in $V_2$ are incident to at least one edge in $F$,
and $|V_3| \leq |V_1|$ by the properties of trees.
We denote with $U = V_1 \cup V_2 \cup V_3$ the set of vertices of interest. It follows that $|U| \leq 4k$.
We can determine vertices of $U$ in linear time.

\subsection{Step 4 of the FPT algorithm}
In this step we want to guess the structure of the fastest paths among all pairs of vertices of $U$. %and then determine their labeling.
For a pair $u,v$ of vertices in $U$, there are $2^{O(k)}$\todo{NK: why? \\ Isn't $k!$} possible paths in $G'$ between them, where each one could be the fastest temporal path from $u$ to $v$ and $v$ to $u$. 

We claim that knowing the structure of the fastest temporal path among two vertices, determines the labeling of such path, up to the label of the first edge.
To prove this we use the following observation, that follows from the definition of the duration of the fastest temporal path.
\begin{observation}\label{obs:FirstLabelAndDuration}
    Let $P$ be the fastest temporal path from $u$ to $v$, where $e_1, e_p \in P$ are its first and last edge, respectively.
    Then knowing the label of the first (last) edge and the duration of $P$, one can uniquely determine the label of the last (first) edge of $P$.
\end{observation}
This is true as, by the definition the duration of $P$ is calculated as the difference of labels of last and first edge plus $1$,
where the label of last edge is considered with some delta periods,
\ie $d(P) = p_i \Delta + \lambda(e_p) - \lambda (e_1) + 1$.
Therefore $d(P) \pmod \Delta \equiv  (\lambda(e_p) - \lambda (e_1) + 1) \pmod \Delta$.
We can now state and prove the following claim.
\begin{claim}
    Suppose $P = (u=v_1, v_2, \dots, v_p = v)$, where $p \geq 2$, is a $u,v$ path in $G'$, which is also the underlying path of the fastest temporal path from $u$ to $v$.
    One can determine the labelling $\lambda$ of $P$, up to the constant $c_{uv} = \lambda(uv_2)$,
    such that the labelling $\lambda$ respects $D'$.
\end{claim}
\begin{proof}
Let $P$ be the fastest temporal path from $u$ to $v$.
We have the following two options:
\begin{enumerate}
\item no other vertex from $P$ is a vertex of interest, \ie $P \setminus \{u,v\} \cap U = \emptyset $,
\item there are at least $3$ vertices of interest in $P$.
\end{enumerate}

In the first case we get that all other vertices in $P$ are reached from $u$ using a (sub)path of $P$.
To prove this suppose for the contradiction, that there is a vertex $v_i \in P \setminus \{u,v\}$, that is reached from $v$ on a path different than $P_i = (u, v_2, v_3, \dots, v_i)$.
Since only $u$ and $v$ are the vertices of interest, it follows that all other vertices on $P$ are of degree $2$. 
Then, the only way to reach $v_i$ from $v$, that differs from $P$, would be to go from $v$ to $u$ using a differnt path $P_2$,
and then go from $u$ to $v_{p-1}, v_{p-2}, \dots, v_i$.
But since $P$ is the fastest temporal path from $u$ to $v$, we get that $d(P_2) \geq d(P)$ and $d(P_2 + (u,v_i) > d(P) > d(P_i)$.

Now to label $P$ we use the fact that the fastest temporal path from $u$ to any $v_i \in P$ is a subpath of $P$, 
therefore we can label each edge using the \cref{obs:FirstLabelAndDuration},
where the duration from $u$ to $v_i$ equals to $D_{u,v_i}$ and 
we set the first label of $P$ to be a constant $c_{uv}$.
This gives us a condition on the label of each edge of $P$, that depends on the value $c_{u,v}$.

Let us now prove the correctness of the second case.
We denote with $v_i \in U$ a vertex of interest in $P \setminus \{u,v\}$.
There are two options, either $v_i$ is reached from $u$ using the subpath $P_i = (u, v_2, v_3, \dots, v_i)$ of $P$,
or there exists a fastest temporal path $P' = (u, w_2, w_3, \dots, w_{p'} = v_i)$, for which $P \cap P' = \{u, v_i\}$.
If the temporal path from $u$ to $v_i$ is a subpath of $P$, then we determine the labeling the same as in previous case.
So we can suppose that the fastest temporal path from $u$ to $v_i$ is of form $P'$.\todo{TBD}
\end{proof}

Therefore, knowing the structure of the exact temporal path $P$ from $u$ to $v$, labeling the path equals to creating a variable $c_{u,v} \in [\Delta]$ that represents the label of the first edge of $P$, 
and $O(len(P))$ constraints, that uniquely determine the labels of all other edges of $P$.
This holds for all pairs of vertices in $U$, therefore
knowing the structure of fastest temporal paths among all pairs of vertices in $U$ creates $k^2$ variables of form $c_{u,v}$.

There are $(2^{O(k)})^{k^2} = 2^{O(k^3)}$ different possible fastest temporal paths among all pairs of vertices in $U$. 
Therefore we have to build $2^{O(k^3)}$ different ILP problems.


\subsection{Step 5 of the FPT algorithm}
In the partially labeled temporal graph $(G',\lambda)$ the durations of the fastest temporal paths among vertices in $U$ satisfy the conditions of $D'$,
but there are still some labels without labels.
Let $e=(uv)$ be one such edge.
\todo[inline]{TBD}

\subsection{Step 6 of the FPT algorithm}
\todo[inline]{This section is wrong, we keep this here as we will use some of the ideas.}
Let $\lambda$ be the labeling of $G'$, that satisfies $D'$.
Let $s \in V(G) \setminus V(G')$, be a vertex of degree one, that was removed from $G$ in Step 1,
and let $u$ be its neighbor in $G$.
First, we can easily assume that $|N_{G'}(u)|\geq 1$, if this is not true, then either $G$ is a star or $G'$ is disconnected and therefore also $G$ is disconnected, where $u$ is in a part of $G$ that forms a star.
We can solve the problem for stars in polynomial time (see \cref{thm:deltaExact-PolyTimeTrees}).

To determine the correct label of edge $su$ we do the following.
We find the vertex $v_i \in N_{G'}(u)$ that is the closest to $v$, regarding the values of $D$, \ie  $D_{s,v_i} \leq D_{s,v_j}$ for all $v_j \in N_{G'}(u)$.
We claim, that the path $P=(s,u,v_i)$ has to be the fastest temporal path from $s$ to $v_i$ in $(G, \lambda'')$.
Suppose that is not true, then there exists a faster path $P^*$ from $s$ to $v_i$, that goes through $u$ (as this is the only neighbor of $s$), through some other vertex $v_j \in N_{G'}(u) \setminus \{v_i \}$, and through some other path $P'$ in $G$, before it finishes it $v_i$, where $P'$ is at least an edge (from $v_j$ to $v_i$). 
Therefore $P^* = (s,u,v_j,P',v_i)$, where $d(P^*) \leq d(P)$, now since $D_{s,v_i} \leq D_{s,v_j}$ for all $v_j \in N_{G'}(u)$, the first part of path $P^*$ from $s$ to $v_j$ takes at least $D_{s,v_i}$ time,
since $v_i \neq v_j$, we need at least one more time-step (one more edge) to traverse from $v_i$ to reach $v_j$, so $d(P^) \geq D_{s,v_i} + 1$, and so $P^*$ cannot be faster than $P$.
Since $P=(s,u,v_i)$ is the fastest temporal path from $s$ to $v_i$ we calculate the label of the edge $su$ as $\lambda (s,v_i) \equiv \lambda(u v_i) + 1 - D_{s,v_i} \pmod \Delta$.

We repeat the above procedure for all degree one vertices in $G$, that we removed in Step 1, and we end up with the labeling $\lambda$ of the whole graph.
Now we have to make sure that all the new labels satisfy $D$, to do this we calculate the matrix $D'$ of fastest temporal paths among all pairs of vertices in $(G, \lambda)$ and compare the results with $D$, if any values differ, we stop and return a \textit{NO} answer, if $D = D'$ we return the labeling $\lambda$.

To calculate $\lambda (s,v_i)$ we need $O(|N_{G'}(u)|) = O(n)$ time, therefore to calculate all labels of edges incident to vertices of degree one in $G$, we need $O(n^2)$ time, calculating $D'$ takes $O(n^3\log n)$ time (see \cref{lemma:calculatingD}), therefore the whole step is performed in polynomial time.


\bibliography{bibliography}	


\clearpage

\appendix

\section{
\texorpdfstring{\deltaExact\ is (NOT) polynomial-time solvable}
{\textsc{Simple Delta-TGR} is polynomial-time solvable}
}\

$G$ can be deduced easily from $D$.

	Let $G$ be the underlying graph of matrix $D$ and let $v$ be an arbitrary vertex in $G$, we want to determine the labeling $\lambda: E(G) \rightarrow [\Delta]$, that assigns exactly one label to each edge in $G$ and satisfies the distances from $D$.
	To do so we observe some properties of the problem.
	
\subsection*{Inequalities}
	
	Let $v \in V$ be an arbitrary vertex in $V(G)$ and let $u \in V \setminus \{v\}$ be a vertex, that is at distance at least $2$ from $v$, in the underlying graph $G$.
	Let $\mathcal{P}_{u}^v$ be a set of all $P_3$ paths on $3$ vertices in $G$, of form $(v_1, v_2, u)$, where $v_1, v_2 \in V(G)$, \st $v_1 v_2, v_2 u \in E(G)$ and $d(v,v_1) < d(v,v_2) < d(v,u)$. 
	Intuitively, we can imagine the set $\mathcal{P}_{u}^v$ as the set of all incoming temporal $P_3$ paths to the vertex $u$, with respect to starting from the vertex $v$.
	
	Let $P = (v_1,v_2,u)$ be an arbitrary path from $\mathcal{P}_u^v$, denote with $\lambda_1, \lambda_2$ the labels of edges $(v_1,v_2)$ and $(v_2, u)$, respectively.
	By the definition of $\mathcal{P}_u^v$ it follows that $v_1, v_2$ are reached by $v$ faster than $u$ is reached by $v$, therefore we get the following inequality:
	\begin{equation}\label{eq:ineq-uv-onePath}
	    \lambda_2 \geq_\Delta \lambda_1 + d(v,u)-d(v,v_2) \pmod \Delta
	\end{equation}
 \todo[inline]{GM: WHY??? THIS IS WRONG}
	We repeat the above procedure for every path $P \in \mathcal{P}$ and collect all the inequalities to a set $S_u^v$.
	Similarly we proceed for every pair of vertices $u$ and $v$.
	At the end we get the collection of sets, each containing inequalities of the form \cref{eq:ineq-uv-onePath}.
	
	\begin{lemma}
	\label{claim:exact-setsOfInequalities}
    Let $D$ be \textsc{YES}-instance of \textsc{Simple $\Delta$-TGR}, and let 
$(G,\lambda,\Delta)$ be a certificate for $D$, where $\lambda:E\rightarrow \{1,2,\ldots,\Delta\}$ a simple periodic labeling of $G$. Then, for every pair $u,v$ of non-adjacent vertices:
	\begin{enumerate}
	    \item \label{itemize:Claim-exact-AtLeastOneEquality-1} $\lambda$ satisfies all the inequalities of the set $S_u^v$, and 
	    \item \label{itemize:Claim-exact-AtLeastOneEquality} at least one of the inequalities of $S_u^v$ is an equality.
	\end{enumerate}
	\end{lemma}

    \begin{proof}
    By the definition of $\mathcal{P}_u^v$, every fastest temporal path from $v$ to $u$ must reach $u$ using one of the $P_3$ paths of $\mathcal{P}_u^v$.
    Let $P$ be an arbitrary temporal path from $v$ to $u$. 
    An arbitrary path $P \in \mathcal{P}_u^v$ is either a part of the fastest path from $v$ to $u$, which means that the path arrives to $u$ at the time equal to $d(v,u)$,
    or it is not a part of the fastest path, which means it arrives to $u$ at some time greater than $d(v,u)$.
    This is how the inequalities from $S_u^v$ are constructed. 
    \todo{GM: WHY? WRONG} 
    Since the fastest path from $v$ to $u$ has to be of duration $d(v,u)$, at least one of the inequalities from $S_u^v$ has to be an equality.    
    \end{proof}
    
    
    \paragraph{Manipulation of inequalities modulo $\Delta$.}
    Suppose we have a path $P$ on three vertices, of form $(v_1, v_2, u)$,
    and suppose $d(v,v_1) < d(v,v_2) < d(v,u)$ for some $v \in V \setminus P$, with $d(v,v_2) = a, d(v,u)=b$. 
    Let us denote with $\lambda_1 = \lambda(v_1 v_2), \lambda_2 = \lambda(v_2 u)$ and $k = b-a$, where $1 \leq k \leq \Delta$ as all edge labels have values from $1$ to $\Delta$.
    Then by \cref{eq:ineq-uv-onePath} we know that 
    \begin{equation}\label{eq:inequalities-properties-example}
        \lambda_2 \geq_\Delta \lambda_1 + k \pmod \Delta.
    \end{equation}
    Note that if $\lambda_2 = \lambda_1$, the duration of temporal path $(P, \lambda) = ((v_1v_2, \lambda_1), (v_2u, \lambda_2))$ is exactly $\Delta+1$,
    therefore $\lambda_1 = \lambda_2$ satisfies \cref{eq:inequalities-properties-example}.
    We can rewrite \cref{eq:inequalities-properties-example} as
    \begin{equation*}
        \lambda_2 \in 
        \{
        \lambda_1 + k, \lambda_1 + (k + 1), \dots , \lambda_1 + (\Delta - 1), \lambda_1 + \Delta 
        \} \pmod \Delta.
    \end{equation*}
    Suppose now we have the following two inequalities
    \begin{align*}
        & \lambda_2 \geq_\Delta \lambda_1 + k \pmod \Delta, \\
        & \lambda_2 \geq_\Delta \lambda_1 + k' \pmod \Delta,
    \end{align*}
    for some $k' > k$, then the set of all possible solutions satisfying both equations is the following
        \begin{equation*}
        \lambda_2 \in 
        \{
        \lambda_1 + k', \lambda_1 + (k' + 1), \dots , \lambda_1 + (\Delta - 1), \lambda_1 + \Delta 
        \} \pmod \Delta.
    \end{equation*}
    
    Observe now that without the condition~\ref{itemize:Claim-exact-AtLeastOneEquality} of \cref{claim:exact-setsOfInequalities}, all inequalities of condition~\ref{itemize:Claim-exact-AtLeastOneEquality-1} can be satisfied by setting the label of every edge of the graph to be the same.
    
    \subsection*{Cycles}
    \begin{definition}[Travel delays]
    Let $e_1=uv$ and $e_2=vz$ be two incident edges with $e_1 \cap e_2 = v$.
    We define the \emph{travel delay} from $u$ to $z$ at vertex $v$, denoted with $\tau_v^{uz}$,
    as the difference of the labels of $e_2$ and $e_1$, where we subtract the value of the label of $e_1$ from the label of $e_2$,  modulo~$\Delta$.
    More specifically:
    \begin{equation}\label{eq:def-VertexWaitingTimes}
       \tau_v^{uz} \equiv \lambda (e_2) - \lambda(e_1) \pmod \Delta.
    \end{equation}
    Similarly, $\tau_v^{zu} \equiv \lambda (e_1) - \lambda(e_2) \pmod \Delta$.
    \end{definition}
    Intuitively, the value of $\tau_v^{uz}$ represents how long a temporal path waits at vertex $v$ when first taking the edge $e_1=uv$ and then the edge $e_2 = vz$.
    
    \begin{observation}
    For any two incident edges $e_1 = uv$ and $e_2 = vz$ on vertices $u,v,z \in V$, with $e_1 \cap e_2 = v$, we have $\tau_v^{zu} = \Delta - \tau_v^{uz} \pmod \Delta$.
    \end{observation}
    
    \begin{proof}
        Let $e_1 = uv$ and $e_2 = vz$ be two edges in $G$ for which $e_1 \cap e_2 = v$. 
        By the definition $\tau_v^{uz} \equiv \lambda (e_2) - \lambda(e_1) \pmod \Delta$ and $\tau_v^{zu} \equiv \lambda (e_1) - \lambda(e_2) \pmod \Delta$.
        Summing now both equations we get $\tau_v^{uz} + \tau_v^{zu} \equiv \lambda(e_2) - \lambda(e_1) + \lambda (e_1) - \lambda(e_2) \pmod \Delta$, and therefore $\tau_v^{uz} + \tau_v^{zu} \equiv 0 \pmod \Delta$, which is equivalent as saying $\tau_v^{uz} \equiv - \tau_v^{zu} \pmod \Delta$ or $\tau_v^{zu} = \Delta - \tau_v^{uz} \pmod \Delta$.
    \end{proof}

    \begin{observation} \label{obs:exact-VertexSum}
    Let $v$ be a vertex of $G$, and let $N(v)=\{u_1, u_2, \ldots, u_k\}$. Then 
    \begin{equation*}
        \sum_{i = 1}^k \tau_{v}^{u_{i}v_{i+1}} \equiv  0 \pmod \Delta,
    \end{equation*}
    where the indices of vertices $u_i$ are taken modulo $k$.
    \end{observation}

    \begin{proof}
        tbd
    \end{proof}


\begin{observation} \label{obs:exact-CyclesSum}
    Let $C = (v_1, v_2, \dots, v_k)$ be a cycle in $G$.
    Then 
    \begin{equation*}
        \sum_{i = 1}^k \tau_{v_i}^{v_{i-1}v_{i+1}} \equiv  0 \pmod \Delta,
    \end{equation*}
    where the indices of vertices $v_i$ are taken modulo $k$ (\ie $v_{-1}=v_{k-1}, v_0 = v_k, v_1 = v_{k+1}, \dots$).
    \end{observation}
    
    
    \begin{proof}
        Using \cref{eq:def-VertexWaitingTimes} and the fact that the indices of vertices $v_i$ are taken modulo $k$, we get the following:
        \begin{align*}
            &\sum_{i = 1}^k \tau_{v_i}^{v_{i-1}v_{i+1}}  \equiv  
            \sum_{i = 1}^k  ( \lambda(v_i v_{i+1}) - \lambda (v_{i-1} v_i) ) \pmod \Delta \equiv \\
            &\lambda(v_1 v_2) - \lambda(v_{k}v_1) + \lambda(v_2 v_3) - \lambda(v_2 v_1) + \dots + \lambda(v_k v_1) - \lambda(v_{k-1}v_k) \pmod \Delta.
        \end{align*}
    \end{proof}
    
    \begin{claim}
    labeling $\lambda$ is a solution for the \textsc{Exact Realization $(\Delta)$} if and only if
    for every cycle $C$ of $(G,\lambda)$ it holds that the sum of the travel delays along $C$ is $0$ modulo $\Delta$.
    \end{claim}
    
    \begin{proof}
        TBD
    \end{proof}
    
\begin{theorem}
	\textsc{Exact Realization $(\Delta)$} can be solved in polynomial time on paths, cycles, trees and stars.
\end{theorem}

\begin{proof}[Idea:]
    For a labeling $\lambda$ we know that it has to satisfy \cref{claim:exact-setsOfInequalities}.
    There are at most $n^2$ different sets $S_u^v$, each containing at most $n^2$ inequalities. 
    Therefore we have $O(n^4)$ inequalities to satisfy with at least of $n^2$ of them being equalities (one for each set $S_u^v$. 
    
    Besides that we can also use the fact from \cref{obs:exact-CyclesSum}, which produces some extra restrictions on all inequalities.
    We believe we can create some ``base of cycles'' over $G$ that would help us use \cref{obs:exact-CyclesSum} efficiently.
\end{proof}


\end{document}